<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
  <link rel="stylesheet" href="dark-login.css"> <!-- external CSS -->
</head>
<body>
  <!-- Floating healthcare emojis -->
  <div class="floating-emoji-1">üíâ</div>
  <div class="floating-emoji-2">üß¨</div>
  <div class="floating-emoji-3">‚öïÔ∏è</div>
  <div class="floating-emoji-4">üî¨</div>
  <div class="floating-emoji-5">üß™</div>
  <div class="floating-emoji-6">üíù</div>

  <div class="container">
    <div class="header">
      <div class="text">Login</div>
      <div class="underline"></div>
    </div>

    <form id="loginForm">
      <div class="inputs">
        <!-- Email -->
        <div class="input">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M12 13.065l11.555-8.316A1.25 1.25 0 0 0 22.5 3h-21a1.25 1.25 0 0 0-.944 1.749L12 13.065z"/>
            <path d="M12 15.935L.445 7.62A1.25 1.25 0 0 0 0 8.75V20.5A1.5 1.5 0 0 0 1.5 22h21a1.5 1.5 0 0 0 1.5-1.5V8.75c0-.397-.188-.772-.445-1.13L12 15.935z"/>
          </svg>
          <input type="text" id="email" placeholder="Email" required>
        </div>

        <!-- Password -->
        <div class="input">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M17 9h-1V7a4 4 0 0 0-8 0v2H7a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-9a2 2 0 0 0-2-2zm-5 8a1.5 1.5 0 1 1 .001-3.001A1.5 1.5 0 0 1 12 17zm3-8H9V7a3 3 0 0 1 6 0v2z"/>
          </svg>
          <input type="password" id="password" placeholder="Password" required>
        </div>
      </div>

      <!-- Error Message -->
      <p id="errorMsg" class="error" style="display:none;"></p>

      <!-- Submit -->
      <div class="submit-container">
        <button type="button" id="loginBtn" class="submit">Login</button>
      </div>
    </form>

    <!-- Switch / Register -->
    <div class="switch-action">
      <p>Don't have an account? <span onclick="window.location.href='register.html'">Register here</span></p>
    </div>

    <!-- Forgot Password -->
    <div class="forgot-password">
      <span onclick="alert('Password recovery not implemented yet.')">Forgot Password?</span>
    </div>
  </div>

  <script>
    const API_BASE_URL = "https://telehealth-webapp-123.azurewebsites.net"; 

    document.getElementById("loginBtn").addEventListener("click", async function(event) {
      event.preventDefault();

      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const errorMsg = document.getElementById("errorMsg");

      errorMsg.style.display = "none";
      errorMsg.textContent = "";

      try {
        const response = await fetch(`${API_BASE_URL}/token`, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ username: email, password: password })
        });

        if (!response.ok) {
          throw new Error("Invalid email or password");
        }

        const data = await response.json();
        console.log("Login Response:", data);

        // Save token to session storage
        sessionStorage.setItem("token", data.access_token);
        sessionStorage.setItem("role", data.role);
        sessionStorage.setItem("user_id", data.user_id);

        // Redirect by role
        if (data.role === "doctor") {
          window.location.href = "doctor_dashboard.html";
        } else if (data.role === "patient") {
          window.location.href = "patient_dashboard.html";
        } else {
          window.location.href = "family_dashboard.html";
        }
      } catch (err) {
        console.error(err);
        errorMsg.textContent = err.message;
        errorMsg.style.display = "block";
      }
    });
  </script>
</body>
</html>